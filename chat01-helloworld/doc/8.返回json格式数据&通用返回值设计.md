# 8.返回json格式数据 & 通用返回值设计
目前比较流行前后端分离，后端只需要为前端提供restful接口，所有的接口都返回json格式的数据，前端接收到json数据之后再进行处理。   
那么在SpringMVC中如何向前端输出json格式的数据呢？   
常见的方式有3种。  
## 方式一：方法上添加@ResponseBody
**需求**   
使用SpringMVC提供一个接口，以json格式输出用户列表。   
**3个步骤**   
1. maven配置引入jackson
> jackson用于将java对象转换为json格式的字符串，也可以将json格式的字符串转换为java对象。   
> 我们的接口需要将java对象转换为json格式的字符串输出到客户端，所以我们需要用到这个包。   
```text
<!--添加jackson依赖-->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-core</artifactId>
    <version>2.11.4</version>
</dependency>
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.11.4</version>
</dependency>
```
2. springmvc配置文件中添加注解驱动   
```text
<!--添加mvc注解驱动-->
<mvc:annotation-driven/>
```
> 添加了这段代码之后，springmvc就被赋予了将java对象转换为json格式字符串输出到客户端的能力。
3. 处理器的方法上添加@ResponseBody注解   
> 如下代码，我们希望list()方法用于向客户端以json格式输出用户列表。   
> 此时只需要在方法上添加一个@ResponseBody注解，SpringMVC发现这个方法上有@ResponseBody这个注解，并且返回值是一个普通的java对象的时候，会将方法的返回值使用jackson转换为json格式的字符串，然后输出到客户端。

```java
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.Collection;
import java.util.concurrent.ConcurrentHashMap;

@Controller
public class UserController {
    /**
     * 用户列表(用户id->用户信息)
     */
    Map<Long, UserDto> userDtoMap = new ConcurrentHashMap<>();

    {
        userDtoMap.put(1L, new UserDto(1L, "f", 20));
        userDtoMap.put(2L, new UserDto(2L, "j", 30));
        userDtoMap.put(3L, new UserDto(3L, "j", 22));
    }

    @GetMapping("/user/list.do")
    @ResponseBody
    public Collection<UserDto> list() {
        return this.userDtoMap.values();
    }
}
```

## 方式二：Controller上添加@ResponseBody注解
当我们Controller中方法很多的时候，且所有方法都要求返回json格式的数据的时候，如果按照方式一，我们需要在每个方法上都要添加@ResponseBody注解，此时有更简单的方法，将所有方法上的@ResponseBody注解都去掉，然后在Controller上加上@ResponseBody就可以了。   
## 方式三：Controller上使用@RestController
SpringMVC提供了一个更好的注解@RestController，相当于@Controller和@ResponseBody这2个注解的合体。
## restful接口通用返回值
客户端调用服务器端接口的时候，接口有可能会发生异常，这些异常信息需要返回给调用者，通常我们会为错误定义错误码以及提示信息。   
一般我们会定义通用的返回值类型，格式如下:

```java
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.ToString;

/**
 * rest接口通用返回值数据结构
 */
@Data
@ToString
@EqualsAndHashCode
public class ResultDto<T> {
    //接口状态（成功/失败）
    private Boolean success;
    //错误代码
    private String code;
    //提示信息
    private String msg;
    //数据
    private T data;
    
    public static <T> ResultDto<T> success(T data) {
        return success(data, "操作成功！");
    }
    
    public static <T> ResultDto<T> success(T data, String msg) {
        ResultDto<T> result = new ResultDto<>();
        result.setSuccess(Boolean.TRUE);
        result.setMsg(msg);
        result.setData(data);
        return result;
    }
}
```
控制器中所有的方法都返回ResultDto类型的结果：   
```java
@RestController
public class UserController {
    Map<Long, UserDto> userDtoMap = new ConcurrentHashMap<>();
    {
        userDtoMap.put(1L, new UserDto(1L, "路人", 30));
        userDtoMap.put(2L, new UserDto(2L, "张三", 20));
        userDtoMap.put(3L, new UserDto(3L, "李四", 18));
    }
    @GetMapping("/user/list.do")
    public ResultDto<Collection<UserDto>> list() {
        return ResultDto.success(this.userDtoMap.values());
    }
    @GetMapping("/user/{id}.do")
    public ResultDto<UserDto> user(@PathVariable("id") Long id) {
        return ResultDto.success(this.userDtoMap.get(id));
    }
}
```
